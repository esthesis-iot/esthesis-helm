##################################################################################################
# Environments definitions
##################################################################################################
environments:
  default:
    values:
      - devMode: false
      - kafkaReplicas: {{ env "KAFKA_REPLICAS" | default 3 }}
      - kafkaTopicReplicas: {{ env "KAFKA_TOPIC_REPLICAS" | default 2 }}
      - kafkaTopicPartitions: {{ env "KAFKA_TOPIC_PARTITIONS" | default 3 }}
  dev:
    values:
      - devMode: true
      - devHost: {{ env "DEV_HOST" }}
      - camundaGatewayUrlCluster: {{ env "CAMUNDA_GATEWAY_URL_CLUSTER" | default "camunda-zeebe-gateway.esthesis:26500" }}
      - kafkaReplicas: {{ env "KAFKA_REPLICAS" | default 1 }}
      - kafkaTopicReplicas: {{ env "KAFKA_TOPIC_REPLICAS" | default 1 }}
      - kafkaTopicPartitions: {{ env "KAFKA_TOPIC_PARTITIONS" | default 3 }}
#      - redisHosts: {{ env "REDIS_HOSTS" | default "redis://redis.esthesis:6379"}}
      - kafkaBootstrapServers: {{ env "KAFKA_BOOTSTRAP_SERVERS" | default "kafka.esthesis:9094" }}

---
##################################################################################################
# Default values
##################################################################################################
helmDefaults:
  timeout: 1800

---
##################################################################################################
# Default state values
##################################################################################################
values:
  - devHost: ""
  - esthesisVersion: 3.0.4-SNAPSHOT
  - timezone: {{ env "TIMEZONE" | default "Europe/Athens" }}
  - esthesisLogLevel: {{ env "ESTHESIS_LOG_LEVEL" | default "WARN" }}
  - esthesisAdminUsername: {{ env "ESTHESIS_ADMIN_USERNAME" | default "esthesis-admin" }}
  - esthesisAdminPassword: {{ env "ESTHESIS_ADMIN_PASSWORD" | default "esthesis-admin" }}
  - esthesisSystemUsername: {{ env "ESTHESIS_SYSTEM_USERNAME" | default "esthesis-system" }}
  - esthesisSystemPassword: {{ env "ESTHESIS_SYSTEM_PASSWORD" | default "esthesis-system" }}
  - esthesisRegistry: {{ env "ESTHESIS_REGISTRY_URL" }}
  # MongoDB
  - mongoDbEnabled: {{ env "MONGODB_ENABLED" | default true }}
  - mongoDbUrlCluster: {{ env "MONGODB_URL_CLUSTER" | default "mongodb://esthesis-mongodb-esthesiscore-svc:27017" }}
  - mongoDbDatabase: {{ env "MONGODB_DATABASE" | default "esthesiscore" }}
  - mongoDbUsername: {{ env "MONGODB_USERNAME" | default .StateValues.esthesisSystemUsername }}
  - mongoDbPassword: {{ env "MONGODB_PASSWORD" | default .StateValues.esthesisSystemPassword }}
  - mongoDbReplicaSets: {{ env "MONGODB_REPLICA_SETS" | default 1 }}
  - mongoDbArbiters: {{ env "MONGODB_ARBITERS" | default 0 }}
  # esthesis UI
  - esthesisUiIngressHostname: {{ env "ESTHESIS_UI_INGRESS_HOSTNAME" | default "esthesis-core.esthesis.localdev" }}
  - esthesisUiLogoutUrl: {{ env "ESTHESIS_UI_LOGOUT_URL" | default "/logout" }}
  - esthesisUiCertManagerClusterIssuer: {{ env "ESTHESIS_UI_CERT_MANAGER_CLUSTER_ISSUER" | default "" }}
  - esthesisUiCertManagerIssuer: {{ env "ESTHESIS_UI_CERT_MANAGER_ISSUER" | default "" }}
  # OIDC
  - oidcAuthorityUrlExternal: {{ env "OIDC_AUTHORITY_URL_EXTERNAL" | default "https://keycloak.esthesis.localdev/realms/esthesis" }}
  - oidcAuthorityUrlCluster: {{ env "OIDC_AUTHORITY_URL_CLUSTER" | default "http://keycloak/realms/esthesis" }}
  - oidcDiscoveryUrlCluster: {{ env "OIDC_DISCOVERY_URL_CLUSTER" | default "http://keycloak/realms/esthesis/.well-known/openid-configuration" }}
  - oidcJwtVerifyLocationCluster: {{ env "OIDC_JWT_VERIFY_LOCATION_CLUSTER" | default "http://keycloak/realms/esthesis/protocol/openid-connect/certs" }}
  # Camunda
  - camundaGatewayUrlCluster: {{ env "CAMUNDA_GATEWAY_URL_CLUSTER" | default "camunda-zeebe-gateway:26500" }}
  # Redis
  - redisHosts: {{ env "REDIS_HOSTS" | default "redis://redis-headless:6379"}}
  # RabbitMQ
  - rabbitmqErlangCookie: {{ env "RABBITMQ_ERLANG_COOKIE" | default .StateValues.esthesisSystemUsername }}
  # Kafka
  - kafkaEnabled: {{ env "KAFKA_ENABLED" | default true }}
  - kafkaBootstrapServers: {{ env "KAFKA_BOOTSTRAP_SERVERS" | default "esthesis-core-kafka-kafka-bootstrap:9092" }}

---
##################################################################################################
# Release definitions
##################################################################################################
releases:
  - name: esthesis-core
    chart: "./"
    version: {{ .StateValues.esthesisVersion | quote }}
    values:
      - devMode: {{ .StateValues.devMode }}
      - devHost: {{ .StateValues.devHost | quote }}
      - timezone: {{ .StateValues.timezone | quote }}
      - esthesisRegistry: {{ .StateValues.esthesisRegistry | quote }}
      - quarkus:
          log:
            min-level: "TRACE"
            level: {{ .StateValues.esthesisLogLevel | quote }}
            category:
              esthesis:
                level: {{ .StateValues.esthesisLogLevel | quote }}
              "org.jboss.resteasy.reactive":
                level: {{ .StateValues.esthesisLogLevel | quote }}
              "io.quarkus.mongodb.panache.common.runtime":
                level: {{ .StateValues.esthesisLogLevel | quote }}
              "org.mongodb":
                level: {{ .StateValues.esthesisLogLevel | quote }}
              "io.quarkus.oidc.token.propagation.reactive":
                level: {{ .StateValues.esthesisLogLevel | quote }}
      - esthesisAdminUsername: {{ .StateValues.esthesisAdminUsername | quote }}
      - esthesisAdminPassword: {{ .StateValues.esthesisAdminPassword | quote }}
      - esthesisSystemUsername: {{ .Values.esthesisSystemUsername | quote }}
      - esthesisSystemPassword: {{ .StateValues.esthesisSystemPassword | quote }}
      - esthesisUiIngressHostname: {{ .StateValues.esthesisUiIngressHostname | quote }}
      - esthesisUiLogoutUrl: {{ .StateValues.esthesisUiLogoutUrl | quote }}
      # OIDC
      - oidcAuthorityUrlExternal: {{ .StateValues.oidcAuthorityUrlExternal | quote }}
      - oidcAuthorityUrlCluster: {{ .StateValues.oidcAuthorityUrlCluster | quote }}
      - oidcDiscoveryUrlCluster: {{ .StateValues.oidcDiscoveryUrlCluster | quote }}
      - oidcJwtVerifyLocationCluster: {{ .StateValues.oidcJwtVerifyLocationCluster | quote }}
      # MongoDB
      - mongoDbEnabled: {{ .StateValues.mongoDbEnabled }}
      - mongoDbUrlCluster: {{ .StateValues.mongoDbUrlCluster | quote }}
      - mongoDbDatabase: {{ .StateValues.mongoDbDatabase | quote }}
      - mongoDbUsername: {{ .StateValues.esthesisSystemUsername | quote }}
      - mongoDbPassword: {{ .StateValues.esthesisSystemPassword | quote }}
      - mongoDbReplicaSets: {{ .StateValues.mongoDbReplicaSets }}
      - mongoDbArbiters: {{ .StateValues.mongoDbArbiters }}
      # REDIS
      - redisHosts: {{ .StateValues.redisHosts | quote }}
      # RabbitMQ
      - rabbitmqErlangCookie: {{ .StateValues.rabbitmqErlangCookie |quote }}
      # Camunda
      - camundaGatewayUrlCluster: {{ .StateValues.camundaGatewayUrlCluster | quote }}
      # Kafka
      - kafkaReplicas: {{ .StateValues.kafkaReplicas }}
      - kafkaEnabled: {{ .StateValues.kafkaEnabled }}
      - kafkaTopicReplicas: {{ .StateValues.kafkaTopicReplicas }}
      - kafkaTopicPartitions: {{ .StateValues.kafkaTopicPartitions }}
      - kafkaBootstrapServers: {{ .StateValues.kafkaBootstrapServers | quote }}
      # Cert Manager
      - esthesisUiCertManagerClusterIssuer: {{ .StateValues.esthesisUiCertManagerClusterIssuer | quote }}
      - esthesisUiCertManagerIssuer: {{ .StateValues.esthesisUiCertManagerIssuer | quote }}


